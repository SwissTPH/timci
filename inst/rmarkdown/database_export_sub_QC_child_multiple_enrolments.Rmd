```{r}
qc_df <- NULL
qc_df2 <- NULL
cleaned_df <- NULL
```

```{r, eval=timci::is_not_empty(day0_data)}
multiple_enrolment_data <- day0_data %>%
  dplyr::filter( prev_id != "" ) %>%
  timci::concatenate_names()
```

```{r, eval=timci::is_not_empty(multiple_enrolment_data), results='asis'}
qc_df <- multiple_enrolment_data %>%
  dplyr::group_by(prev_id) %>% 
  dplyr::mutate(date = sort(date_visit,
                            decreasing = TRUE,
                            na.last = TRUE)) %>% # order by descending dates
  dplyr::mutate(row_n = row_number()) %>%
  tidyr::pivot_wider(prev_id,
                     names_from = row_n,
                     values_from = c(date, child_id, name, uuid))
qc_df <- day0_data %>%
  timci::concatenate_names() %>%
  dplyr::select(child_id, date_visit, name) %>%
  dplyr::rename(date = date_visit) %>% 
  merge(qc_df,
        by.x = "child_id",
        by.y = "prev_id",
        all.y = TRUE)
```

```{r, results = 'asis'}
timci::quality_check_export(df = qc_df,
                            idx = qc_multiple_enrolment_id,
                            label = "multiple_enrolments",
                            cdir = qc_dir,
                            description = "Multiple enrolments")
```
